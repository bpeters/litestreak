<!DOCTYPE html>
<html>
<head>
  <title>Impact Game</title>
  <LINK href="/stylesheets/main.css" rel="stylesheet" type="text/css">
  <script src="/lib/impact/impact.js"></script>
  <script src="/lib/game/main.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io();
    var namerand  = Math.floor(Math.random()*999);
    var playername = "player" + namerand;

    socket.on('addplayer', function (playerlist,otherplayername) {
      var player = ig.game.getEntitiesByType( EntityPlayer )[0];
      player.messagebox = player.messagebox + '\n' + otherplayername + ' joined';
      for(var i = 0; i < playerlist.length; i++) {
        if(player.gamename != playerlist[i]) {
          ig.game.spawnEntity( EntityOtherplayer, 400, 400, {gamename:playerlist[i]} );
        }
      }
    });

    socket.on('playermove', function (positionx,positiony,currentanimation,thisgamename) {
      var otherplayer = ig.game.getEntitiesByType( EntityOtherplayer );
      if(otherplayer) {
        for(var i in otherplayer) {
          if(thisgamename == otherplayer[i].gamename) {
            otherplayer[i].pos.x = positionx;
            otherplayer[i].pos.y = positiony;
            otherplayer[i].animation = currentanimation;
          }
        }
      }
    });

    socket.on('playershoot', function (positionx,positiony,angle) {
      ig.game.spawnEntity( EntityNetbullet, positionx, positiony, {angle: angle} );
    });

    socket.on('message', function (data) {
      var player = ig.game.getEntitiesByType( EntityPlayer )[0];
      if(player) {
        player.messagebox = player.messagebox + '\n' + data + ' disconnected';
      }
    });

    socket.on('netreplayer', function (playerlist) {
      var netplayers = ig.game.getEntitiesByType( EntityOtherplayer );
      if(netplayers) {
        for(var i in netplayers) {
          netplayers[i].kill();
        }
      }
      for(var i in playerlist) {
        if(playername != playerlist[i]) {
          ig.game.spawnEntity( EntityOtherplayer, 400, 400, {gamename:playerlist[i]} );
        }
      }
    });
  </script>
</head>
<body>
  <canvas id="canvas"></canvas>
</body>
</html>
